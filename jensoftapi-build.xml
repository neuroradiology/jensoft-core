<?xml version="1.0" encoding="ISO-8859-1"?>

<project name="jensoft API" default="dist">
	<description>
	        JenSoft API
	 </description>


	<dirname property="basedir" file="${ant.file}" />

	<property name="src" location="src/main/java" />

	<property name="build" location="temp-build" />

	<property name="dist" location="dist" />
	<property name="dist-lib" location="${dist}/lib" />
	<property name="dist-x2d" location="${dist}/x2d" />
	<property name="dist-x2d-templates" location="${dist-x2d}/templates" />
	<property name="dist-jnlp" location="${dist}/jnlp" />

	<property name="jensoftapi-bin-jar-name" value="jensoftapi-1.0.jar" />
	<property name="jensoftapi-src-jar-name" value="jensoftapi-1.0-sources.jar" />
	<property name="jensoftapi-demo-bin-jar-name" value="jensoftapi-demo-1.0.jar" />
	<property name="jensoftapi-demo-src-jar-name" value="jensoftapi-demo-1.0-sources.jar" />
	<property name="jensoftapi-pack-name" value="jensoftapi-pack-1.0.zip" />

	<property name="jensoftapi-bin-jar" location="${dist-lib}/${jensoftapi-bin-jar-name}" />
	<property name="jensoftapi-src-jar" location="${dist-lib}/${jensoftapi-src-jar-name}" />
	<property name="jensoftapi-demo-bin-jar" location="${dist-lib}/${jensoftapi-demo-bin-jar-name}" />
	<property name="jensoftapi-demo-src-jar" location="${dist-lib}/${jensoftapi-demo-src-jar-name}" />
	<property name="jensoftapi-pack" location="${dist}/${jensoftapi-pack-name}" />

	<property name="jenscript-package" location="${src}\com\jensoft\sw2d\core\jenscript" />
	<property name="jenscript-templates" location="${src}\com\jensoft\sw2d\core\jenscript\templates" />

	<property name="x2d-package" location="${src}\com\jensoft\sw2d\core\x2d" />
	<property name="x2d-templates" location="${src}\com\jensoft\sw2d\core\x2d\template" />

	<!-- target class path come from maven build and is use for the task def -->
	<taskdef name="jensoft-ui-jnlp" classname="com.jensoft.sw2d.core.demo.task.JenSofAPIDemoTask" classpath="target/classes" />
	<taskdef name="jensoft-ui-x2d" classname="com.jensoft.sw2d.core.demo.task.X2DUITask" classpath="target/classes" />
	<taskdef name="jensoft-ui-view" classname="com.jensoft.sw2d.core.demo.task.ViewUITask" classpath="target/classes" />

	<!-- just use for compile exotic classe with jetty jenscript test server,servlet, demo source tab, etc.. -->
	<path id="lib.class.path">
		<fileset dir="${basedir}/ext-lib">
			<include name="**/*.jar" />
			<include name="**/*.zip" />
		</fileset>
	</path>

	<!--Generate Sources -->
	<target name="generate-sources">
		<jensoft-ui-view src="${src}" packageRoot="com.jensoft.demo.views" />
		<jensoft-ui-x2d src="${src}" packageRoot="com.jensoft.demo.x2d" />
		<delete dir="${dist-jnlp}" />
		<mkdir dir="${dist-jnlp}" />
		<jensoft-ui-jnlp src="${src}" dest="${dist-jnlp}" packageRoot="com.jensoft.demo" jnlpCodeBase="http://localhost:8080/jensoft-web/demo/jnlp" jarResourcesCodeBase="http://localhost:8080/jensoft-web/demo/resources" jarResources="${jensoftapi-bin-jar-name},${jensoftapi-demo-bin-jar-name},${jensoftapi-demo-src-jar-name}" />
	</target>

	<!-- Make jensoft api jars files -->
	<target name="jars" depends="build">

		<!-- create the project jensoft api binary jar archive -->
		<jar destfile="${jensoftapi-bin-jar}">
			<fileset dir="${build}">
				<include name="**/*.class" />
				<include name="**/*.ttf" />
				<include name="**/*.TTF" />
				<include name="**/*.js" />
				<include name="**/*.xsd" />
				<include name="**/*.properties" />
				<include name="**/*.png" />
				<include name="**/*.PNG" />
				<exclude name="**/jensoft/demo/**" />
				<exclude name="**/jenscript/old/**" />
				<exclude name="**/jenscript/bootstrap/**" />
				<exclude name="**/**/JenScriptJettyTestServer.class" />
				<exclude name="**/**/JenSoftDemoTask.class" />
			</fileset>
		</jar>


		<!-- create the project jensoft API source jar archive -->
		<jar destfile="${jensoftapi-src-jar}">
			<fileset dir="${src}">
				<include name="com/jensoft/sw2d/core/**" />
				<include name="**/*.ttf" />
				<include name="**/*.TTF" />
				<include name="**/*.png" />
				<include name="**/*.PNG" />
				<include name="**/*.js" />
				<include name="**/*.xsd" />
				<include name="**/*.properties" />
				<include name="**/*.html" />
				<include name="**/*.htm" />
				<include name="**/*.xml" />
				<exclude name="**/jensoft/demo/**" />
				<exclude name="**/jenscript/old/**" />
				<exclude name="**/**/JETServerTest.java" />
				<exclude name="**/jenscript/old/**" />
				<exclude name="**/jenscript/WEB-INF/**" />
				<exclude name="**/jenscript/META-INF/**" />
				<exclude name="**/jenscript/templates/**" />
			</fileset>
		</jar>

		<!-- create the project jensoft api demo jar archive -->
		<jar destfile="${jensoftapi-demo-bin-jar}">
			<fileset dir="${build}">
				<include name="**/*.class" />
				<include name="**/*.ttf" />
				<include name="**/*.TTF" />
				<include name="**/*.png" />
				<include name="**/*.PNG" />
				<include name="**/*.jpg" />
				<include name="**/*.jpeg" />
				<include name="**/*.JPG" />
				<include name="**/*.xml" />
				<exclude name="**/*.sw2d" />
				<exclude name="**/demo/portfolio/**" />
				<exclude name="**/demo/apibrowser/**" />
				<exclude name="**/demo/source/**" />
				<exclude name="**/jensoft/sw2d/**" />
				<exclude name="**/jenscript/old/**" />
			</fileset>
			<fileset dir="${build}/demo/monitoring">
				<include name="**/*.sw2d" />
			</fileset>
		</jar>

		<!-- create the project jensoft api demo source jar archive -->
		<jar destfile="${jensoftapi-demo-src-jar}">
			<fileset dir="${src}">
				<include name="**/com/jensoft/demo/**/*.java" />
			</fileset>
			<fileset dir="${src}">
				<include name="**/com/jensoft/demo/**/*.xml" />
			</fileset>
			<fileset dir="${build}/demo/monitoring">
				<include name="**/*.sw2d" />
			</fileset>
			<includesfile>
			</includesfile>
		</jar>

		<!-- create api zip pack -->
		<jar destfile="${jensoftapi-pack}">
			<fileset dir="${dist}">
				<!--exclude name="**/JenScript/**" / -->
			</fileset>
		</jar>


	</target>

	<!-- sign all jensoft api jar -->
	<target name="sign" description="sign jensoft api jars files" depends="jars">
		<signjar jar="${jensoftapi-bin-jar}" alias="jensoft" keystore="jensoft.keystore" storepass="password" preservelastmodified="true" />
		<signjar jar="${jensoftapi-src-jar}" alias="jensoft" keystore="jensoft.keystore" storepass="password" preservelastmodified="true" />
		<signjar jar="${jensoftapi-demo-bin-jar}" alias="jensoft" keystore="jensoft.keystore" storepass="password" preservelastmodified="true" />
		<signjar jar="${jensoftapi-demo-src-jar}" alias="jensoft" keystore="jensoft.keystore" storepass="password" preservelastmodified="true" />
		<signjar jar="${jensoftapi-pack}" alias="jensoft" keystore="jensoft.keystore" storepass="password" preservelastmodified="true" />
	</target>

	<!-- create jensoft api framework dist -->
	<target name="dist" description="make jensoft distribution to dist" depends="sign,x2d,jenscript">
		<delete dir="${build}" />
	</target>


	<!-- compile class, call init and generate source UI before compile -->
	<target name="compile" depends="init,generate-sources">
		<!-- compile src-->
		<echo message="Compile JenSoft API Classes" level="info" />
		<javac includeantruntime="true" destdir="${build}" debug="true">
			<classpath refid="lib.class.path" />
			<src location="${src}" />
		</javac>
	</target>

	<!-- build -->
	<target name="build" depends="compile">
		<!-- copy font to build-->
		<echo message="Copy Fonts file to build package" level="info" />
		<copy todir="${build}/com/jensoft/sw2d/core/palette/font" flatten="true">
			<fileset dir="${src}/com/jensoft/sw2d/core/palette/font">
				<include name="**/*.ttf" />
				<include name="**/*.TTF" />
			</fileset>
		</copy>

		<!-- copy png to build-->
		<echo message="Copy PNG and jpeg file to build package" level="info" />
		<copy todir="${build}">
			<fileset dir="${src}" includes="**/*.png,**/*.PNG,**/*.jpg,**/*.JPG,**/*.jpeg" />
		</copy>

		<!-- copy html to build-->
		<echo message="Copy HTML file to build package" level="info" />
		<copy todir="${build}">
			<fileset dir="${src}" includes="**/*.html,**/*.htm" />
		</copy>

		<!-- copy xsd to build-->
		<echo message="Copy XSD file to build package" level="info" />
		<copy todir="${build}">
			<fileset dir="${src}" includes="**/*.xsd" />
		</copy>

		<!-- copy js to build-->
		<echo message="Copy JS file to build package" level="info" />
		<copy todir="${build}">
			<fileset dir="${src}" includes="**/*.js" />
		</copy>

		<!-- copy x2d xml template  to build-->
		<echo message="Copy XML file to build package" level="info" />
		<copy todir="${build}">
			<fileset dir="${src}" includes="**/*.xml" />
		</copy>

		<!-- copy properties  to build-->
		<echo message="Copy properties to build package" level="info" />
		<copy todir="${build}">
			<fileset dir="${src}" includes="**/*.properties" />
		</copy>


		<!-- copy font to build-->
		<echo message="Copy Fonts file to build package" level="info" />
		<copy todir="${build}/com/jensoft/sw2d/core/palette/font" flatten="true">
			<fileset dir="${src}/com/jensoft/sw2d/core/palette/font">
				<include name="**/*.ttf" />
				<include name="**/*.TTF" />
			</fileset>
		</copy>

		<!-- copy monitoring ressource to build-->
		<echo message="Copy Monitoring samples file to build package" level="info" />
		<copy todir="${build}/demo/monitoring" flatten="true">
			<fileset dir="${src}/com/jensoft/demo">
				<include name="**/**/*.sw2d" />
			</fileset>
		</copy>


	</target>


	<!-- takes x2d files (Schema and XML templates) from source and put in dist/x2d -->
	<target name="x2d">
		<!-- copy x2d schema to dist-->
		<copy todir="${dist-x2d}" flatten="false">
			<fileset dir="${x2d-package}">
				<include name="**/x2d.xsd" />
			</fileset>
		</copy>

		<!-- copy x2d templates to dist-->
		<copy todir="${dist-x2d-templates}" flatten="false">
			<fileset dir="${x2d-templates}">
				<include name="**/**/*.xml" />
			</fileset>
		</copy>
	</target>

	<!--	make jenscript	-->
	<target name="jenscript">
		<!--	copy jenscript js from jenscript to dist	-->
		<echo message="Copy jenscript file to build package" level="info" />
		<copy todir="${dist}/JenScript" flatten="false">
			<fileset dir="${jenscript-package}">
				<exclude name="**/old/**" />
				<exclude name="**/WEB-INF/**" />
				<exclude name="**/bootstrap/**" />
				<exclude name="**/templates/**" />
				<exclude name="**/META-INF/**" />
				<exclude name="**/*.html" />
				<exclude name="**/*.png" />
				<exclude name="**/*.java" />
			</fileset>
		</copy>

		<!-- 	copy jenscript templates to dist  -->
		<copy todir="${dist}/JenScript/templates" flatten="false">
			<fileset dir="${jenscript-templates}">
				<include name="**/**/*.html" />
			</fileset>
		</copy>
	</target>

	<!-- 	clean work directories  -->
	<target name="clean">
		<delete dir="${build}" />
		<delete dir="${dist}" />
		<delete dir="${demo}" />
	</target>


	<!-- 	init creation directories  -->
	<target name="init" depends="clean">
		<echo message="Create Jensoft Dist Root" level="info" />
		<mkdir dir="${dist}" />

		<echo message="Create Jensoft JNLP container" level="info" />
		<mkdir dir="${dist-jnlp}" />

		<echo message="Create Jensoft lib container" level="info" />
		<mkdir dir="${dist-lib}" />

		<echo message="Create Jensoft X2D container" level="info" />
		<mkdir dir="${dist-x2d}" />
		<mkdir dir="${dist-x2d-templates}" />

		<echo message="Create Jensof JenScript container" level="info" />
		<mkdir dir="${dist}/JenScript" />
		<mkdir dir="${dist}/JenScript/templates" />

		<echo message="Create Temp build directory" level="info" />
		<mkdir dir="${build}" />
		<mkdir dir="${build}/demo/monitoring" />

	</target>

</project>
